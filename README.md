## Installation

0. Clone the database and install all dependencies:

```sh
$ npm install
```

1. Copy the `wrangler.toml.example` file to `wrangler.toml` and fill in the necessary values:

```sh
$ cp wrangler.toml.example wrangler.toml
```

  - Replace `$APP_NAME` with your Cloudflare Workers application name
  - Replace `$CURRENT_DATE` with the current date like this `2022-01-01`

2. Create a new D1 database using Wrangler:

```sh
$ npx wrangler d1 create <your-database-name>
```

_Note that if you haven't yet used Wrangler, you will be prompted to log in to Cloudflare._

Copy the output of this command, which is structured TOML configuration, into your `wrangler.toml`.

3. Set up local development database with Prisma Migrate (SQLite):

```sh
$ printf 'DATABASE_URL="file:./prisma/dev.db"\n' > .env
$ npx prisma migrate dev --name init
```

This creates `prisma/dev.db`, applies migrations, and generates Prisma Client and Zod types.

4. Optional: Apply schema to Cloudflare D1

If you want your D1 database to match your Prisma schema, create a D1 migration and fill it with SQL generated by Prisma:

```sh
# Create an empty D1 migration file (Wrangler v4+ recommended)
$ npx wrangler d1 migrations create <your-database-name> init

# Generate SQL from your Prisma schema into the migration file path you just created
$ npx prisma migrate diff \
  --from-empty \
  --to-schema-datamodel ./prisma/schema.prisma \
  --script \
  --output migrations/0001_init.sql

# Apply the migration locally
$ npx wrangler d1 migrations apply <your-database-name>

# Apply to remote (production) when ready
$ npx wrangler d1 migrations apply <your-database-name> --remote
```

### Alternative: Apply existing Prisma migration SQL to D1

cd /home/aditya/SIH/edu-pulse && npx --yes prisma migrate dev --name init --create-only | cat

If you already have a Prisma migration file (for example `prisma/migrations/20250906143923_init/migration.sql`), you can apply it directly to D1 without creating a Wrangler-managed migration:

```sh
# Install Wrangler and log in (one-time)
$ npm i -D wrangler@latest
$ npx wrangler login

# Create the D1 database (skip if already created)
$ npx wrangler d1 create edu-pulse

# Apply to a local D1 (for testing)
$ npx wrangler d1 execute edu-pulse --local --file=prisma/migrations/20250906151153_init/migration.sql

# Apply to remote (production/staging)
$ npx wrangler d1 execute edu-pulse --remote --file=prisma/migrations/20250906151153_init/migration.sql
```

Make sure your `wrangler.toml` has the D1 binding:

```toml
[[d1_databases]]
binding = "DB"
database_name = "edu-pulse"
database_id = "<copied-from-wrangler-create-output>"
```

5. Deploy the application when ready:

```sh
$ npm run deploy
```

Notes:
- Ensure `wrangler.toml` has your D1 binding and Google OAuth vars (`GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `GOOGLE_REDIRECT_URI`).
